<!DOCTYPE html>
<html lang="en" class="no-js">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Alternate Column Scroll | Codrops</title>
		<link rel="stylesheet" type="text/css" href="css/base.css" />
	</head>
	<body >
		<main>
			<div class="columns" data-scroll-container>
				<div class="column-wrap column-wrap--height">
					<div class="column">
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="2">
								<div class="column__item-img" style="background-image:url(img/1.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Cyber Blue</span>
								<span>2011</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="5">
								<div class="column__item-img" style="background-image:url(img/2.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Gnostic Will</span>
								<span>2012</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="8">
								<div class="column__item-img" style="background-image:url(img/3.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>French Kiss</span>
								<span>2013</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="11">
								<div class="column__item-img" style="background-image:url(img/4.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Half Life</span>
								<span>2014</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="14">
								<div class="column__item-img" style="background-image:url(img/5.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Love Boat</span>
								<span>2015</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="17">
								<div class="column__item-img" style="background-image:url(img/6.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Golden Ray</span>
								<span>2016</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="20">
								<div class="column__item-img" style="background-image:url(img/7.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Blame Game</span>
								<span>2017</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="23">
								<div class="column__item-img" style="background-image:url(img/8.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Lone Dust</span>
								<span>2018</span>
							</figcaption>
						</figure>
					</div><!-- /column -->
				</div><!-- /column-wrap -->
				<div class="column-wrap">
					<div class="column" data-scroll-section>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="1">
								<div class="column__item-img" style="background-image:url(img/9.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Lucky Wood</span>
								<span>2019</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="4">
								<div class="column__item-img" style="background-image:url(img/10.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Good Earth</span>
								<span>2020</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="7">
								<div class="column__item-img" style="background-image:url(img/11.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Empty Words</span>
								<span>2021</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="10">
								<div class="column__item-img" style="background-image:url(img/12.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Nonage Line</span>
								<span>2009</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="13">
								<div class="column__item-img" style="background-image:url(img/13.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Blue Hell</span>
								<span>2010</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="16">
								<div class="column__item-img" style="background-image:url(img/14.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Cold Blood</span>
								<span>2011</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="19">
								<div class="column__item-img" style="background-image:url(img/15.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Tulip Heat</span>
								<span>2012</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="22">
								<div class="column__item-img" style="background-image:url(img/16.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Red Wrath</span>
								<span>2013</span>
							</figcaption>
						</figure>
					</div><!-- /column -->
				</div>
				<div class="column-wrap column-wrap--height">
					<div class="column">
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="3">
								<div class="column__item-img" style="background-image:url(img/17.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Bold Human</span>
								<span>2014</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="6">
								<div class="column__item-img" style="background-image:url(img/18.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Loyal Royal</span>
								<span>2015</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="9">
								<div class="column__item-img" style="background-image:url(img/19.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Lone Cone</span>
								<span>2016</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="12">
								<div class="column__item-img" style="background-image:url(img/20.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Dutch Green</span>
								<span>2017</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="15">
								<div class="column__item-img" style="background-image:url(img/21.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Valley Hill</span>
								<span>2018</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="18">
								<div class="column__item-img" style="background-image:url(img/22.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Kale Hale</span>
								<span>2019</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="21">
								<div class="column__item-img" style="background-image:url(img/23.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Fake Cake</span>
								<span>2020</span>
							</figcaption>
						</figure>
						<figure class="column__item">
							<div class="column__item-imgwrap" data-pos="24">
								<div class="column__item-img" style="background-image:url(img/24.jpg)"></div>
							</div>
							<figcaption class="column__item-caption">
								<span>Book Belly</span>
								<span>2021</span>
							</figcaption>
						</figure>
					</div><!-- /column -->
				</div><!-- /column-wrap -->
			</div><!-- columns -->
			<div class="content">
				<div class="content__item">
					<h2 class="content__item-title">Lucky Wood</h2>
					<div class="content__item-text">
						<span>Faith, you're driving me away
						You do it every day
						You don't mean it
						But it hurts like hell</span>
						<span>2019</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Cyber Blue</h2>
					<div class="content__item-text">
						<span>My brain says I'm receiving pain
						A lack of oxygen
						From my life support
						My iron lung
						</span>
						<span>2011</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Bold Human</h2>
					<div class="content__item-text">
						<span>We're too young to fall asleep
						Too cynical to speak
						We are losing it
						Can't you tell?</span>
						<span>2014</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Good Earth</h2>
					<div class="content__item-text">
						<span>We scratch our eternal itch
						A twentieth century bitch
						And we are grateful for
						Our iron lung</span>
						<span>2020</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Gnostic Will</h2>
					<div class="content__item-text">
						<span>The head shrinkers
						They want everything
						My Uncle Bill
						My Belisha beacon</span>
						<span>2012</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Loyal Royal</h2>
					<div class="content__item-text">
						<span>The head shrinkers
						They want everything
						My Uncle Bill
						My Belisha beacon</span>
						<span>2015</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Empty Words</h2>
					<div class="content__item-text">
						<span>Suck, suck your teenage thumb
						Toilet trained and dumb
						When the power runs out
						We'll just hum</span>
						<span>2021</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">French Kiss</h2>
					<div class="content__item-text">
						<span>This, this is our new song
						Just like the last one
						A total waste of time
						My iron lung</span>
						<span>2013</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Lone Cone</h2>
					<div class="content__item-text">
						<span>And if you're frightened
						You can be frightened
						You can be, it's OK</span>
						<span>2016</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Nonage Line</h2>
					<div class="content__item-text">
						<span>Lost in the mountain
						Rust in my brain
						The air is sacred here
						In spite of your claim</span>
						<span>2009</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Half Life</h2>
					<div class="content__item-text">
						<span>Up on the rooftops
						Out of reach
						Trickster is meaningless
						Trickster is weak</span>
						<span>2014</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Dutch Green</h2>
					<div class="content__item-text">
						<span>He's talking out the world
						Talking out the world</span>
						<span>2017</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Blue Hell</h2>
					<div class="content__item-text">
						<span>Hey, hey, hey
						This is only halfway
						Hey, hey, hey
						This is only halfway</span>
						<span>2010</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Love Boat</h2>
					<div class="content__item-text">
						<span>I wanted you so bad
						That I couldn't say
						All these things fall apart</span>
						<span>2015</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Valley Hill</h2>
					<div class="content__item-text">
						<span>We wanted out so bad
						We couldn't say
						These things fall apart</span>
						<span>2018</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Cold Blood</h2>
					<div class="content__item-text">
						<span>Truant kids
						A can of brick dust worms
						Who do not want to climb down from
						Their chestnut tree</span>
						<span>2011</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Golden Ray</h2>
					<div class="content__item-text">
						<span>Long white gloves
						Police tread carefully
						Escaped from the zoo
						The perfect child facsimile is</span>
						<span>2016</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Kale Hale</h2>
					<div class="content__item-text">
						<span>Please could you stop the noise? 
							I'm trying to get some rest
							From all the unborn chicken 
							voices in my head</span>
						<span>2019</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Tulip Heat</h2>
					<div class="content__item-text">
						<span>What's that?
						I may be paranoid, but not an android</span>
						<span>2012</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Blame Game</h2>
					<div class="content__item-text">
						<span>When I am king you will be first against the wall
						With your opinion which is of no consequence at all</span>
						<span>2017</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Fake Cake</h2>
					<div class="content__item-text">
						<span>Ambition makes you look pretty ugly
						Kicking and squealing, Gucci little piggy</span>
						<span>2017</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Red Wrath</h2>
					<div class="content__item-text">
						<span>You don't remember, you don't remember
						Why don't you remember my name?</span>
						<span>2013</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Lone Dust</h2>
					<div class="content__item-text">
						<span>Off with his head, man, off with his head, man
						Why don't you remember my name? I guess he does</span>
						<span>2018</span>
					</div>
				</div>
				<div class="content__item">
					<h2 class="content__item-title">Book Belly</h2>
					<div class="content__item-text">
						<span>Rain down, rain down
						Come on, rain down on me
						From a great height
						From a great height, height</span>
						<span>2021</span>
					</div>
				</div>
				<nav class="content__nav">
					<div class="content__nav-wrap">
						<div class="content__nav-item" style="background-image:url(img/25.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/26.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/27.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/28.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/29.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/30.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/31.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/32.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/33.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/34.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/35.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/36.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/37.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/38.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/39.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/40.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/41.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/42.jpg)"></div>
						<div class="content__nav-item" style="background-image:url(img/43.jpg)"></div>
					</div>
				</nav>
				<button class="unbutton button-back"><svg viewBox="0 0 50 9" width="100%"><path d="M0 4.5l5-3M0 4.5l5 3M50 4.5h-77"></path></svg></button>
			</div>
		</main>
		<script src="js/locomotive-scroll.min.js"></script>
		<script src="js/gsap.min.js"></script>
		<script>
			const calcWinsize = () => {
				return { width: window.innerWidth, height: window.innerHeight };
			};

			const adjustedBoundingRect = el => {
				var rect = el.getBoundingClientRect();
				var style = getComputedStyle(el);
				var tx = style.transform;

				if (tx) {
					var sx, sy, dx, dy;
					if (tx.startsWith('matrix3d(')) {
						var ta = tx.slice(9,-1).split(/, /);
						sx = +ta[0];
						sy = +ta[5];
						dx = +ta[12];
						dy = +ta[13];
					} else if (tx.startsWith('matrix(')) {
						var ta = tx.slice(7,-1).split(/, /);
						sx = +ta[0];
						sy = +ta[3];
						dx = +ta[4];
						dy = +ta[5];
					} else {
						return rect;
    				}
					var to = style.transformOrigin;
					var x = rect.x - dx - (1 - sx) * parseFloat(to);
					var y = rect.y - dy - (1 - sy) * parseFloat(to.slice(to.indexOf(' ') + 1));
					var w = sx ? rect.width / sx : el.offsetWidth;
					var h = sy ? rect.height / sy : el.offsetHeight;
					return {
						x: x, y: y, width: w, height: h, top: y, right: x + w, bottom: y + h, left: x
					};
				} else {
					return rect;
				}
			}
			const bodyEl = document.body;
			calcWinsize();

			class GridItem {
				DOM = {
					el: null,
					img: {outer: null, inner: null},
					caption: null,
					contentId: null,
					contentItem: null
				};
				position = -1;
				
				constructor(DOM_el) {
					this.DOM.el = DOM_el;
					this.DOM.img.outer = this.DOM.el.querySelector('.column__item-imgwrap');
					this.DOM.img.inner = this.DOM.el.querySelector('.column__item-img');
					this.position = Number(this.DOM.img.outer.dataset.pos) - 1;
					this.DOM.caption = this.DOM.el.querySelector('figcaption');
				}
			}

			class ContentItem {
				DOM = {
					el: null,
					title: null,
					text: null,
				};
				
				constructor(DOM_el) {
					this.DOM.el = DOM_el;
					this.DOM.title = this.DOM.el.querySelector('.content__item-title');
					this.DOM.text = this.DOM.el.querySelector('.content__item-text');
				}
			}

			class Grid {
				DOM = {
					el: null,
					oddColumns: null,
					gridItems: null,
					content: document.querySelector('.content'),
					contentItems: document.querySelectorAll('.content__item'),
					heading: {top: document.querySelector('.heading--up'), bottom: document.querySelector('.heading--down')},
					backCtrl: document.querySelector('.button-back'),
					contentNav: document.querySelector('.content__nav'),
					contentNavItems: document.querySelectorAll('.content__nav-item'),
				};
				gridItemArr = [];
				currentGridItem = -1;
				isGridView = true;
				isAnimating = false;
				lastscroll = 0;
				
				constructor(DOM_el) {
					
					this.DOM.el = DOM_el;
					this.DOM.oddColumns = [...this.DOM.el.querySelectorAll('.column')].filter((_, index) => index != 1);
					this.DOM.gridItems = [...this.DOM.el.querySelectorAll('.column__item')];
					this.DOM.gridItems.forEach(gridItem => {
						const newItem =  new GridItem(gridItem);
						this.gridItemArr.push(newItem);
						newItem.contentItem = new ContentItem(this.DOM.contentItems[newItem.position]);
					});
					
					this.initSmoothScroll();
					this.initEvents();
					this.trackVisibleItems();
				}

				initSmoothScroll() {
					this.lscroll = new LocomotiveScroll({
						el: this.DOM.el,
						smooth: true,
						lerp: 0.13,
						smartphone: {smooth: true},
						tablet: {smooth: true}
					});
					this.lscroll.on('scroll', obj => {
						this.lastscroll = obj.scroll.y;
						this.DOM.oddColumns.forEach(column => column.style.transform = `translateY(${obj.scroll.y}px)`);
					});
				}

				initEvents() {
					for (const [position, gridItem] of this.gridItemArr.entries()) {
						gridItem.DOM.img.outer.addEventListener('click', () => {
							if ( !this.isGridView || this.isAnimating || document.documentElement.classList.contains('has-scroll-scrolling') ) {
								return false;
							}
							this.isAnimating = true;
							this.isGridView = false;
							this.currentGridItem = position;
							this.lscroll.destroy();
							this.showContent(gridItem);
						});
						
						gridItem.DOM.img.outer.addEventListener('mouseenter', () => {
							if ( !this.isGridView || this.isAnimating ) {
								return false;
							}
							gsap.killTweensOf([gridItem.DOM.img.outer, gridItem.DOM.img.inner]);
							gsap.timeline({
								defaults: {duration: 1.4, ease: 'expo'},
								onComplete: () => gsap.set([gridItem.DOM.img.outer, gridItem.DOM.img.inner], {willChange: ''})
							})
							.addLabel('start', 0)
							.set([gridItem.DOM.img.outer, gridItem.DOM.img.inner], { willChange: 'transform' }, 'start')
							.to(gridItem.DOM.img.outer, {scaleY: 0.95,scaleX: 0.88}, 'start')
							.to(gridItem.DOM.img.inner, {ease: 'power4', scaleY: 1.2, scaleX: 1.7}, 'start');
						});

						gridItem.DOM.img.outer.addEventListener('mouseleave', () => {
							if ( !this.isGridView || this.isAnimating ) {
								return false;
							}
							gsap.killTweensOf([gridItem.DOM.img.outer, gridItem.DOM.img.inner]);
							gsap.timeline({
								defaults: {duration: 1.4, ease: 'expo'},
								onComplete: () => gsap.set([gridItem.DOM.img.outer, gridItem.DOM.img.inner], { willChange: '' })
							})
							.addLabel('start', 0)
							.set([gridItem.DOM.img.outer, gridItem.DOM.img.inner], { willChange: 'transform' }, 'start')
							.to([gridItem.DOM.img.outer, gridItem.DOM.img.inner], {scale: 1}, 0);
						});
					}

					window.addEventListener('resize', () => {
						if ( this.isGridView ) {
							return false;
						}
						const imageTransform = this.calcTransformImage();
						gsap.set(this.gridItemArr[this.currentGridItem].DOM.img.outer, {
							scale: imageTransform.scale,
							x: imageTransform.x,
							y: imageTransform.y
						});
						for (const [position, viewportGridItem] of this.viewportGridItems.entries()) {
							const imgOuter = viewportGridItem.DOM.img.outer;    
							gsap.set(viewportGridItem.DOM.img.outer, {
								scale: this.getFinalScaleValue(imgOuter),
								x: this.getFinalTranslationValue(imgOuter, position).x,
								y: this.getFinalTranslationValue(imgOuter, position).y
							});
						}
					});

					this.DOM.backCtrl.addEventListener('click', () => {
						if ( this.isGridView || this.isAnimating ) {
							return false;
						}
						this.isAnimating = true;
						this.isGridView = true;
						this.initSmoothScroll();
						this.lscroll.scrollTo(this.lastscroll, {duration: 0, disableLerp: true});
						this.closeContent();
					});

				}

				showContent(gridItem) {
					this.viewportGridItems = this.gridItemArr.filter(el => el != gridItem && el.DOM.el.classList.contains('in-view'));
					this.remainingGridItems = this.gridItemArr.filter(el => !this.viewportGridItems.includes(el) && el != gridItem).map(gridItem => gridItem.DOM.el);
					this.viewportGridItemsImgOuter = this.viewportGridItems.map(gridItem => gridItem.DOM.img.outer);
					const imageTransform = this.calcTransformImage();

					gsap.killTweensOf([gridItem.DOM.img.outer, gridItem.DOM.img.inner]);
					this.timeline = gsap.timeline({
						defaults: {
							duration: 1.4, 
							ease: 'expo.inOut'
						},
						onStart: () => bodyEl.classList.add('oh'),
						onComplete: () => {
							gsap.set(this.remainingGridItems, {opacity: 0});
							this.isAnimating = false;
						}
					})
					.addLabel('start', 0)
					.set([gridItem.DOM.el, gridItem.DOM.el.parentNode.parentNode], {
						zIndex: 100
					}, 'start')
					.set([gridItem.DOM.img.outer, gridItem.DOM.img.inner, this.viewportGridItemsImgOuter], {
						willChange: 'transform, opacity'
					}, 'start')
					.to(this.DOM.heading.top, {
						y: '-200%',
						scaleY: 4
					}, 'start')
					.to(this.DOM.heading.bottom, {
						y: '200%',
						scaleY: 4
					}, 'start+=0.05')
					.to(gridItem.DOM.img.outer, {
						scale: imageTransform.scale,
						x: imageTransform.x,
						y: imageTransform.y,
						onComplete: () => gsap.set(gridItem.DOM.img.outer, {willChange: ''})
					}, 'start')
					.to(gridItem.DOM.img.inner, {
						scale: 1,
						onComplete: () => gsap.set(gridItem.DOM.img.inner, {willChange: ''})
					}, 'start')
					.add(() => {
						gsap.set(this.DOM.contentNavItems, {
							y: `${gsap.utils.random(100,300)}%`, 
							opacity: 0
						});
					}, 'start');

					for (const [position, viewportGridItem] of this.viewportGridItems.entries()) {
						const imgOuter = viewportGridItem.DOM.img.outer;
						
						this.timeline
						.to([viewportGridItem.DOM.caption, gridItem.DOM.caption], {
							ease: 'expo',
							opacity: 0,
							delay: 0.03*position
						}, 'start')
						.to(viewportGridItem.DOM.img.outer, {
							scale: this.getFinalScaleValue(imgOuter),
							x: this.getFinalTranslationValue(imgOuter, position).x,
							y: this.getFinalTranslationValue(imgOuter, position).y,
							onComplete: () => gsap.set(imgOuter, {willChange: ''}),
							delay: 0.03*position
						}, 'start');
					}

					this.timeline
					.addLabel('showContent', 'start+=0.2')
					.to([...this.DOM.contentNavItems].slice(this.viewportGridItems.length+1), {
						y: '0%', 
						opacity: 1,
						delay: pos => 0.03*pos
					}, 'showContent')
					.add(() => {
						gridItem.contentItem.DOM.el.classList.add('content__item--current');
						bodyEl.classList.add('view-content');
					}, 'showContent')
					.to([this.DOM.backCtrl, this.DOM.contentNav, gridItem.contentItem.DOM.text], {
						opacity: 1
					}, 'showContent')
					.to(gridItem.contentItem.DOM.title, {
						opacity: 1,
						startAt: {
							y: '-100%',
							scaleY: 3
						},
						y: '0%',
						scaleY: 1
					}, 'showContent')
				}

				closeContent() {
					const gridItem = this.gridItemArr[this.currentGridItem];
					
					gsap.timeline({
						defaults: {
							duration: 1.4, 
							ease: 'expo.inOut'
						},
						onStart: () => {
							gsap.set(this.remainingGridItems, {opacity: 1});

							bodyEl.classList.remove('oh');
						},
						onComplete: () => {
							this.isAnimating = false;
						}
					})
					.addLabel('start', 0)
					.to([this.DOM.backCtrl, this.DOM.contentNav, gridItem.contentItem.DOM.text], {
						opacity: 0
					}, 'start')
					.to(gridItem.contentItem.DOM.title, {
						opacity: 0,
						y: '-100%',
						scaleY: 3
					}, 'start')
					.to([...this.DOM.contentNavItems].slice(this.viewportGridItems.length+1), {
						y: `${gsap.utils.random(100,300)}%`,
						opacity: 0,
						delay: pos => -0.03*pos,
						onComplete: () => bodyEl.classList.remove('view-content')
					}, 'start')
					.add(() => gridItem.contentItem.DOM.el.classList.remove('content__item--current'))
					
					.set([gridItem.DOM.img.outer, this.viewportGridItemsImgOuter], {
						willChange: 'transform, opacity'
					}, 'start')
					.to(gridItem.DOM.img.outer, {
						scale: 1,
						x: 0,
						y: 0,
						onComplete: () => {
							gsap.set(gridItem.DOM.img.outer, {willChange: ''});
							gsap.set([gridItem.DOM.el, gridItem.DOM.el.parentNode.parentNode], {zIndex: 1});
						}
					}, 'start')
					.to(this.viewportGridItemsImgOuter, {
						scale: 1,
						x: 0,
						y: 0,
						stagger: pos => -0.03*pos,
						onComplete: () => {
							gsap.set(this.viewportGridItemsImgOuter, {willChange: ''});
						}
					}, 'start')

					
					.addLabel('showGrid', 'start+=0.2')
					.to([this.DOM.heading.top, this.DOM.heading.bottom], {
						y: '0%',
						scaleY: 1
					}, 'showGrid')
					.to([this.viewportGridItems.map(gridItem => gridItem.DOM.caption), gridItem.DOM.caption], {
						ease: 'power4.in',
						opacity: 1
					}, 'showGrid')
					
				}

				getFinalScaleValue(gridItemImageOuter) {
					return this.DOM.contentNavItems[0].offsetHeight / gridItemImageOuter.offsetHeight;
				}

				getFinalTranslationValue(gridItemImageOuter, position) {
					const imgrect = adjustedBoundingRect(gridItemImageOuter);
					const navrect = adjustedBoundingRect(this.DOM.contentNavItems[position]);
					return {
						x: (navrect.left + navrect.width/2) - (imgrect.left + imgrect.width/2),
						y: (navrect.top + navrect.height/2) - (imgrect.top + imgrect.height/2)
					};
				}

				trackVisibleItems() {
					const observer = new IntersectionObserver((entries, observer) => {
						entries.forEach(entry => {
							if (entry.intersectionRatio > 0) {
								entry.target.classList.add('in-view');
							} 
							else {
								entry.target.classList.remove('in-view');
							}
						});
					});
					this.DOM.gridItems.forEach(item => observer.observe(item));
				}

				calcTransformImage() {
					const imgrect = adjustedBoundingRect(this.gridItemArr[this.currentGridItem].DOM.img.outer);
					return {
						scale: winsize.height * 0.7 / imgrect.height,
						x: winsize.width * 0.5 - (imgrect.left + imgrect.width/2),
						y: winsize.height * 0.5 - (imgrect.top + imgrect.height/2)
					};
				}
			}

			window.addEventListener('resize', () => winsize = calcWinsize());

			new Grid(document.querySelector('.columns'));
		</script>
	</body>
</html>
